# Example Blueprint with finn_config section
# This demonstrates direct control over FINN DataflowBuildConfig parameters

name: bert_with_finn_overrides
version: 2.0

# Standard BrainSmith configuration sections...
nodes:
  canonical_ops:
    available: ["MatMul", "LayerNorm", "Add", "MultiHeadAttention"]
  hw_kernels:
    available: ["layernorm_hls", "matmul_dsp"]

transforms:
  model_topology:
    available: ["streamlining", "cleanup"]

# Direct FINN configuration overrides
finn_config:
  # Clock and performance settings
  synth_clk_period_ns: 4.0  # 250MHz instead of default 200MHz
  hls_clk_period_ns: 4.0    # Match synthesis clock
  target_fps: 1000          # Aggressive performance target
  
  # Build outputs - multiple outputs
  generate_outputs: ["STITCHED_IP", "ESTIMATE_REPORTS", "RTLSIM_PERFORMANCE"]
  
  # Enable DCP generation for easier deployment
  stitched_ip_gen_dcp: true
  
  # Verification configuration
  verify_steps: ["FOLDED_HLS_CPPSIM", "STITCHED_IP_RTLSIM"]
  verify_save_rtlsim_waveforms: true
  verification_atol: 0.01  # Tighter tolerance
  
  # Advanced optimization
  mvau_wwidth_max: 64      # Allow wider streams
  minimize_bit_width: true
  standalone_thresholds: true
  
  # FIFO configuration
  auto_fifo_depths: true
  auto_fifo_strategy: "CHARACTERIZE"  # Use characterization method
  large_fifo_mem_style: "BRAM"       # Force BRAM for large FIFOs
  split_large_fifos: true
  fifosim_n_inferences: 100
  
  # Debug and verbosity
  verbose: true
  enable_hw_debug: false
  enable_build_pdb_debug: true
  
  # Build control
  save_intermediate_models: true
  stop_step: "step_measure_rtlsim_performance"  # Stop before synthesis
  
  # Hardware targeting
  board: "U250"
  shell_flow_type: "VITIS_ALVEO"
  vitis_opt_strategy: "PERFORMANCE"

# Legacy compatibility - these still work but finn_config takes precedence
build_configuration:
  auto_fifo_depths: false  # This would be overridden by finn_config
  save_intermediate_models: false  # This would be overridden by finn_config