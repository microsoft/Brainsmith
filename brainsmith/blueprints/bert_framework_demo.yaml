version: "3.0"
name: "BERT Framework Demo"
description: "Demonstrates framework-qualified step names and collision resolution"

hw_compiler:
  kernels:
    # Core compute kernels
    - ["MatrixVectorUnit", ["rtl"]]
    - ["LayerNorm", ["hls"]]
    - ["Softmax", ["hls", "rtl"]]
    - ["Shuffle", ["hls"]]
    
  transforms:
    cleanup:
      - "RemoveIdentityOps"
      - "RemoveUnusedTensors"
      
    topology_opt:
      - "ExpandNorms"
      - "FoldConstants"
      - "ConvertQONNXtoFINN"
      
  build_steps:
    # === Demonstrating framework-qualified step names ===
    
    # Brainsmith-specific cleanup steps
    - "cleanup"                          # Brainsmith version (default)
    - "cleanup_advanced"                 # Brainsmith only
    
    # Explicit framework qualification for collision resolution
    - "brainsmith:qonnx_to_finn"        # Explicitly use Brainsmith's comprehensive version
    # - "finn:qonnx_to_finn"             # Could use FINN's simpler version instead
    
    # FINN steps (no collision, clean names)
    - "tidy_up"                         # FINN step (no prefix needed)
    - "streamline"                      # FINN step
    
    # More Brainsmith preprocessing
    - "generate_reference_io"           # Brainsmith
    - "infer_hardware"                  # Brainsmith
    
    # Standard FINN pipeline with clean names
    - "create_dataflow_partition"       # FINN (no step_ prefix)
    - "specialize_layers"               # FINN
    - "target_fps_parallelization"      # FINN
    - "apply_folding_config"            # FINN
    - "minimize_bit_width"              # FINN
    - "generate_estimate_reports"       # FINN
    - "hw_codegen"                      # FINN
    - "hw_ipgen"                        # FINN
    
    # Framework qualification examples for clarity
    - "finn:set_fifo_depths"            # Explicit FINN
    - "finn:create_stitched_ip"         # Explicit FINN
    
    # Brainsmith post-processing
    - "shell_metadata_handover"         # Brainsmith (no collision)
    
  config_flags:
    target_device: "xczu7ev-ffvc1156-2-e"
    target_clock_ns: 3.33

finn_config:
  board: "Pynq-Z1" 
  clock_period_ns: 3.33
  auto_fifo_depths: true
  minimize_bit_width: true

processing:
  preprocessing: []
  postprocessing: []

search:
  strategy: "exhaustive"
  constraints: []

global:
  output_stage: "stitched_ip"
  enable_profiling: false
  working_directory: "./bert_framework_demo"