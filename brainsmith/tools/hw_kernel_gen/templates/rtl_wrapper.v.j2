{# Jinja2 template for Verilog Wrapper #}
// Auto-generated by Brainsmith Hardware Kernel Generator
// Date: {{ generation_timestamp }} {# Use pre-formatted timestamp #}

module {{ kernel.name }}_wrapper #(
    // Parameters from original module
{%- for param in kernel.parameters %}
    parameter {{ param.name }} = {{ param.template_param_name }}{% if not loop.last %},{% endif %}
{%- endfor %}
) (
{%- set comma_needed = joiner(",") %} {# Initialize comma joiner #}
{%- for interface in kernel.interfaces.values() | sort(attribute='type.value') %}

    // --- {{ interface.type.value | replace('_', ' ') | title }} {% if interface.type != InterfaceType.GLOBAL_CONTROL %}({{ interface.name }}){% endif %} ---
    {%- for port in interface.ports.values() | sort(attribute='name') %}
    {{ comma_needed() }}
    {{ port.direction.value }} {% if port.width and port.width != '1' %}[{{ port.width }}] {% endif %}{{ port.name }}
    {%- endfor %}
{%- endfor %}
);

// Instantiate the wrapped kernel
{{ kernel.name }} #(
    // Pass parameters
{%- for param in kernel.parameters %}
    .{{ param.name }}( {{ param.template_param_name }} ){% if not loop.last %},{% endif %}
{%- endfor %}
) {{ kernel.name }}_inst (
{%- set comma_needed = joiner(",") %} {# Re-initialize comma joiner #}
{%- for interface in kernel.interfaces.values() | sort(attribute='type.value') %}

    // --- {{ interface.type.value | replace('_', ' ') | title }} {% if interface.type != InterfaceType.GLOBAL_CONTROL %}({{ interface.name }}){% endif %} ---
    {%- for port in interface.ports.values() | sort(attribute='name') %}
    {{ comma_needed() }}
    .{{ port.name }}( {{ port.name }} )
    {%- endfor %}
{%- endfor %}
);

endmodule
