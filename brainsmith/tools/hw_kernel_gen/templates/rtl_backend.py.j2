{#-
RTL Backend Template with Explicit Parameter Resolution

Generates minimal RTL Backend subclasses with explicit parameter
assignments generated at compile-time from CodegenBinding.
-#}
# Auto-generated by Brainsmith Hardware Kernel Generator
# Generated from: {{ source_file }}
# Date: {{ generation_timestamp }}

{% if base_kernel_class %}
from finn.custom_op.fpgadataflow.{{ base_kernel_class.lower() }} import {{ base_kernel_class }}
{% endif %}
from brainsmith.dataflow.core.auto_rtl_backend import AutoRTLBackend
from qonnx.core.datatype import DataType


class {{ kernel_name }}_rtl({% if base_kernel_class %}{{ base_kernel_class }}, {% endif %}AutoRTLBackend):
    """RTL backend for {{ kernel_name }} operation.
    
    Auto-generated from SystemVerilog RTL analysis.
    Uses explicit parameter resolution generated at compile-time.
    {% if operation_description %}
    
    {{ operation_description }}
    {% endif %}
    """
    
    def __init__(self, onnx_node, **kwargs):
        super().__init__(onnx_node, **kwargs)
    
    @property
    def finn_rtllib_module(self) -> str:
        """Return finn-rtllib module name for this operation."""
        return "{{ finn_rtllib_module }}"
    
    def get_nodeattr_types(self):
        """Explicit node attribute types for RTL backend."""
        my_attrs = {
            {% for param_name, attr_spec in explicit_nodeattr_types.items() %}
            "{{ param_name }}": {{ attr_spec | replace('null', 'None') | replace('true', 'True') | replace('false', 'False') }},
            {% endfor %}
        }
        
        # Merge with parent class attributes
        {% if base_kernel_class %}
        my_attrs.update({{ base_kernel_class }}.get_nodeattr_types(self))
        {% endif %}
        my_attrs.update(AutoRTLBackend.get_nodeattr_types(self))
        
        return my_attrs
    
    def prepare_codegen_rtl_values(self, model):
        """Explicit parameter resolution for RTL template generation."""
        code_gen_dict = {}
        
        # Basic module information
        code_gen_dict["$MODULE_NAME_AXI_WRAPPER$"] = [self.get_verilog_top_module_name()]
        code_gen_dict["$TOP_MODULE$"] = code_gen_dict["$MODULE_NAME_AXI_WRAPPER$"]
        
        # Standard stream width variables
        code_gen_dict["$IBITS$"] = [str(self.get_instream_width())]
        code_gen_dict["$OBITS$"] = [str(self.get_outstream_width())]
        
        # Explicit parameter assignments (generated from CodegenBinding at compile-time)
        {% for assignment in explicit_parameter_assignments %}
        code_gen_dict["{{ assignment.template_var }}"] = [{{ assignment.assignment }}]  # {{ assignment.comment }}
        {% endfor %}
        
        return code_gen_dict
    
    def get_supporting_rtl_files(self) -> list:
        """Get list of supporting RTL files to include."""
        return [
            {% for file_name in supporting_rtl_files %}
            "{{ file_name }}",
            {% endfor %}
        ]