{#-
Minimalist RTL Wrapper Template

This template generates clean Verilog wrappers with:
- Templated parameters from the original module
- Simple port connections
- Minimal structure following the OLD template reference
-#}
// Auto-generated by Brainsmith Hardware Kernel Generator
// Generated from: {{ source_file }}
// Date: {{ generation_timestamp }}

module {{ kernel_name }}_wrapper #(
{%- set cat_params = categorized_parameters -%}
{%- set all_param_sections = [] -%}
{%- if cat_params.general_parameters -%}{%- set _ = all_param_sections.append('general') -%}{%- endif -%}
{%- if cat_params.axilite_parameters -%}{%- set _ = all_param_sections.append('axilite') -%}{%- endif -%}
{%- if cat_params.internal_datatype_groups -%}{%- set _ = all_param_sections.append('internal') -%}{%- endif -%}
{%- if cat_params.interface_parameter_groups -%}{%- set _ = all_param_sections.append('interface') -%}{%- endif -%}

{%- if cat_params.general_parameters %}
    // General algorithm parameters
{% for param in cat_params.general_parameters %}
    parameter {{ param.name }} = {{ param.template_param_name }}{% if not (loop.last and 'general' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{%- endif %}

{%- if cat_params.axilite_parameters %}
    // AXI-Lite configuration parameter
{% for param in cat_params.axilite_parameters %}
    parameter {{ param.name }} = {{ param.template_param_name }}{% if not (loop.last and 'axilite' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{%- endif %}

{%- if cat_params.internal_datatype_groups %}
{% set internal_datatype_names = cat_params.internal_datatype_groups.keys() | list %}
{% for datatype_name in internal_datatype_names %}
    // {{ datatype_name }} datatype
{% set params = cat_params.internal_datatype_groups[datatype_name] -%}
{% for param in params %}
    parameter {{ param.name }} = {{ param.template_param_name }}{% if not (loop.last and datatype_name == internal_datatype_names[-1] and 'internal' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{% endfor %}
{%- endif %}

{%- if cat_params.interface_parameter_groups %}
{% for group in cat_params.interface_parameter_groups %}
    // {{ group.interface.name }} interface parameters
{% for param in group.parameters %}
    parameter {{ param.name }} = {{ param.template_param_name }}{% if not (loop.last and group == cat_params.interface_parameter_groups[-1] and 'interface' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{% endfor %}
{%- endif %}
) (
    // Global Control
    input wire ap_clk,
    input wire ap_rst_n,
    input wire ap_start,
    output wire ap_done,
    output wire ap_idle,
    output wire ap_ready{% if input_interfaces|length + output_interfaces|length + weight_interfaces|length + config_interfaces|length > 0 %},{% endif %}

{#- Input interfaces -#}
{% for interface in input_interfaces %}
{{ "\n" if loop.first else "" }}    // {{ interface.name }}: INPUT interface
    input wire [${{ interface.name.upper() }}_STREAM_WIDTH$-1:0] {{ interface.name }}_TDATA,
    input wire {{ interface.name }}_TVALID,
    output wire {{ interface.name }}_TREADY{% if not loop.last or output_interfaces|length + weight_interfaces|length + config_interfaces|length > 0 %},{% endif %}
{% endfor %}

{#- Output interfaces -#}
{% for interface in output_interfaces %}
{{ "\n" if loop.first else "" }}    // {{ interface.name }}: OUTPUT interface
    output wire [${{ interface.name.upper() }}_STREAM_WIDTH$-1:0] {{ interface.name }}_TDATA,
    output wire {{ interface.name }}_TVALID,
    input wire {{ interface.name }}_TREADY{% if not loop.last or weight_interfaces|length + config_interfaces|length > 0 %},{% endif %}
{% endfor %}

{#- Weight interfaces -#}
{% for interface in weight_interfaces %}
{{ "\n" if loop.first else "" }}    // {{ interface.name }}: WEIGHT interface
    input wire [${{ interface.name.upper() }}_STREAM_WIDTH$-1:0] {{ interface.name }}_TDATA,
    input wire {{ interface.name }}_TVALID,
    output wire {{ interface.name }}_TREADY{% if not loop.last or config_interfaces|length > 0 %},{% endif %}
{% endfor %}

{#- Config interfaces -#}
{% for interface in config_interfaces %}
{{ "\n" if loop.first else "" }}    // {{ interface.name }}: CONFIG interface (AXI-Lite)
    input wire {{ interface.name }}_AWVALID,
    output wire {{ interface.name }}_AWREADY,
    input wire [31:0] {{ interface.name }}_AWADDR,
    input wire {{ interface.name }}_WVALID,
    output wire {{ interface.name }}_WREADY,
    input wire [31:0] {{ interface.name }}_WDATA,
    input wire [3:0] {{ interface.name }}_WSTRB,
    output wire {{ interface.name }}_BVALID,
    input wire {{ interface.name }}_BREADY,
    output wire [1:0] {{ interface.name }}_BRESP,
    input wire {{ interface.name }}_ARVALID,
    output wire {{ interface.name }}_ARREADY,
    input wire [31:0] {{ interface.name }}_ARADDR,
    output wire {{ interface.name }}_RVALID,
    input wire {{ interface.name }}_RREADY,
    output wire [31:0] {{ interface.name }}_RDATA,
    output wire [1:0] {{ interface.name }}_RRESP{% if not loop.last %},{% endif %}
{% endfor %}
);

    // Instantiate the wrapped kernel
    {{ kernel_name }} #(
{%- set cat_params = categorized_parameters -%}
{%- set all_param_sections = [] -%}
{%- if cat_params.general_parameters -%}{%- set _ = all_param_sections.append('general') -%}{%- endif -%}
{%- if cat_params.axilite_parameters -%}{%- set _ = all_param_sections.append('axilite') -%}{%- endif -%}
{%- if cat_params.internal_datatype_groups -%}{%- set _ = all_param_sections.append('internal') -%}{%- endif -%}
{%- if cat_params.interface_parameter_groups -%}{%- set _ = all_param_sections.append('interface') -%}{%- endif -%}

{%- if cat_params.general_parameters %}
        // General algorithm parameters
{% for param in cat_params.general_parameters %}
        .{{ param.name }}({{ param.name }}){% if not (loop.last and 'general' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{%- endif %}

{%- if cat_params.axilite_parameters %}
        // AXI-Lite configuration parameters
{% for param in cat_params.axilite_parameters %}
        .{{ param.name }}({{ param.name }}){% if not (loop.last and 'axilite' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{%- endif %}

{%- if cat_params.internal_datatype_groups %}
{% set internal_datatype_names = cat_params.internal_datatype_groups.keys() | list %}
{% for datatype_name in internal_datatype_names %}
        // {{ datatype_name }} datatype
{% set params = cat_params.internal_datatype_groups[datatype_name] -%}
{% for param in params %}
        .{{ param.name }}({{ param.name }}){% if not (loop.last and datatype_name == internal_datatype_names[-1] and 'internal' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{% endfor %}
{%- endif %}

{%- if cat_params.interface_parameter_groups %}
{% for group in cat_params.interface_parameter_groups %}
        // {{ group.interface.name }} interface parameters
{% for param in group.parameters %}
        .{{ param.name }}({{ param.name }}){% if not (loop.last and group == cat_params.interface_parameter_groups[-1] and 'interface' == all_param_sections[-1]) %},
{% endif %}{% endfor %}
{% endfor %}
{%- endif %}
    ) {{ kernel_name }}_inst (
        // Global control
        .ap_clk(ap_clk),
        .ap_rst_n(ap_rst_n),
        .ap_start(ap_start),
        .ap_done(ap_done),
        .ap_idle(ap_idle),
        .ap_ready(ap_ready){% if input_interfaces|length + output_interfaces|length + weight_interfaces|length + config_interfaces|length > 0 %},{% endif %}

{#- Connect interfaces -#}
{% for interface in input_interfaces %}
{{ "\n" if loop.first else "" }}        // {{ interface.name }} connections
        .{{ interface.name }}_TDATA({{ interface.name }}_TDATA),
        .{{ interface.name }}_TVALID({{ interface.name }}_TVALID),
        .{{ interface.name }}_TREADY({{ interface.name }}_TREADY){% if not loop.last or output_interfaces|length + weight_interfaces|length + config_interfaces|length > 0 %},{% endif %}
{% endfor %}
{% for interface in output_interfaces %}
{{ "\n" if loop.first else "" }}        // {{ interface.name }} connections
        .{{ interface.name }}_TDATA({{ interface.name }}_TDATA),
        .{{ interface.name }}_TVALID({{ interface.name }}_TVALID),
        .{{ interface.name }}_TREADY({{ interface.name }}_TREADY){% if not loop.last or weight_interfaces|length + config_interfaces|length > 0 %},{% endif %}
{% endfor %}
{% for interface in weight_interfaces %}
{{ "\n" if loop.first else "" }}        // {{ interface.name }} connections
        .{{ interface.name }}_TDATA({{ interface.name }}_TDATA),
        .{{ interface.name }}_TVALID({{ interface.name }}_TVALID),
        .{{ interface.name }}_TREADY({{ interface.name }}_TREADY){% if not loop.last or config_interfaces|length > 0 %},{% endif %}
{% endfor %}
{% for interface in config_interfaces %}
{{ "\n" if loop.first else "" }}        // {{ interface.name }} connections
        .{{ interface.name }}_AWVALID({{ interface.name }}_AWVALID),
        .{{ interface.name }}_AWREADY({{ interface.name }}_AWREADY),
        .{{ interface.name }}_AWADDR({{ interface.name }}_AWADDR),
        .{{ interface.name }}_WVALID({{ interface.name }}_WVALID),
        .{{ interface.name }}_WREADY({{ interface.name }}_WREADY),
        .{{ interface.name }}_WDATA({{ interface.name }}_WDATA),
        .{{ interface.name }}_WSTRB({{ interface.name }}_WSTRB),
        .{{ interface.name }}_BVALID({{ interface.name }}_BVALID),
        .{{ interface.name }}_BREADY({{ interface.name }}_BREADY),
        .{{ interface.name }}_BRESP({{ interface.name }}_BRESP),
        .{{ interface.name }}_ARVALID({{ interface.name }}_ARVALID),
        .{{ interface.name }}_ARREADY({{ interface.name }}_ARREADY),
        .{{ interface.name }}_ARADDR({{ interface.name }}_ARADDR),
        .{{ interface.name }}_RVALID({{ interface.name }}_RVALID),
        .{{ interface.name }}_RREADY({{ interface.name }}_RREADY),
        .{{ interface.name }}_RDATA({{ interface.name }}_RDATA),
        .{{ interface.name }}_RRESP({{ interface.name }}_RRESP){% if not loop.last %},{% endif %}
{% endfor %}
    );

endmodule // {{ kernel_name }}_wrapper