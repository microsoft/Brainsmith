[pytest]
testpaths = tests/unit tests/integration tests/parity tests/pipeline tests/dual_pipeline tests/frameworks
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers for tiered execution
markers =
    spike: Spike tests for validating patterns before production implementation
    fast: Fast tests (< 1 min, no FINN)
    finn_build: Real FINN execution (1-30 min)
    rtlsim: RTL simulation tests (30min - hours)
    slow: Slow tests (hours)
    bitfile: Bitfile generation (hours - days)
    hardware: Requires actual FPGA hardware
    timeout: Test timeout in seconds (provided by pytest-timeout plugin)
    integration: Integration tests
    parity: Parity tests comparing manual vs auto HWCustomOp implementations
    computational: Computational parity tests verifying operator outputs
    cppsim: Tests requiring C++ simulation with Vivado/Vitis HLS
    hls: Tests requiring HLS code generation
    rtl: Tests requiring RTL synthesis
    pipeline: Pipeline integration tests (ONNX → Hardware → Execution)
    golden: Tests validating against golden reference (NumPy/PyTorch)
    phase1: Phase 1 pipeline tests (pipeline + golden reference)
    phase2: Phase 2 pipeline tests (cross-backend + parametric)
    phase3: Phase 3 pipeline tests (snapshots + properties)
    dual_pipeline: Dual pipeline parity tests (manual + auto vs golden + hardware parity)
    core: Core parity tests (shapes, widths, datatypes)
    hw_estimation: Hardware estimation parity tests (resources, cycles)
    single_kernel: SingleKernelTest framework tests (new composition-based framework)
    dual_kernel: DualKernelTest framework tests (new composition-based framework)
    validation: Meta-tests for validating test frameworks
    execution: Execution parity tests (manual vs auto execution comparison)

# Console output
console_output_style = progress
log_cli = false
log_cli_level = INFO

# Coverage
addopts =
    --strict-markers
    --strict-config
    --cov=brainsmith.dse
    --cov-report=html:htmlcov
    --cov-report=term-missing:skip-covered
    --cov-report=json:coverage.json
    --cov-branch
    -ra
    --tb=short
    --durations=20

# Timeouts
# Default: 2 hours for FINN/RTL builds
# timeout = 7200
# Thread-based timeout
# timeout_method = thread

# Warnings
filterwarnings =
    error::DeprecationWarning
    error::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    # Ignore all pkg_resources deprecations from FINN dependencies (brevitas, google libs)
    ignore:.*pkg_resources.*:DeprecationWarning
    ignore:Deprecated call to.*pkg_resources.*:DeprecationWarning
    # Ignore syntax warnings from FINN dependencies (invalid escape sequences)
    ignore:invalid escape sequence:DeprecationWarning
    # Ignore ONNX mapping deprecations from Brevitas/QONNX
    ignore:.*mapping.TENSOR_TYPE_TO_NP_TYPE.*:DeprecationWarning
    # Ignore is_finn_op deprecation from QONNX
    ignore:.*is_finn_op is deprecated.*:DeprecationWarning
    # Ignore hasCustomOp deprecation from QONNX
    ignore:.*hasCustomOp is deprecated.*:DeprecationWarning
