# Copyright (C) 2024, Advanced Micro Devices, Inc. All rights reserved.
#
# This file is subject to the Xilinx Design License Agreement located
# in the LICENSE.md file in the root directory of this repository.
#
# This file contains confidential and proprietary information of Xilinx, Inc.
# and is protected under U.S. and international copyright and other
# intellectual property laws.
#
# DISCLAIMER
# This disclaimer is not a license and does not grant any rights to the materials
# distributed herewith. Except as otherwise provided in a valid license issued to
# you by Xilinx, and to the maximum extent permitted by applicable law: (1) THESE
# MATERIALS ARE MADE AVAILABLE "AS IS" AND WITH ALL FAULTS, AND XILINX HEREBY
# DISCLAIMS ALL WARRANTIES AND CONDITIONS, EXPRESS, IMPLIED, OR STATUTORY,
# INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, NONINFRINGEMENT, OR
# FITNESS FOR ANY PARTICULAR PURPOSE; and (2) Xilinx shall not be liable (whether
# in contract or tort, including negligence, or under any other theory of
# liability) for any loss or damage of any kind or nature related to, arising
# under or in connection with these materials, including for any direct, or any
# indirect, special, incidental, or consequential loss or damage (including loss
# of data, profits, goodwill, or any type of loss or damage suffered as a result
# of any action brought by a third party) even if such damage or loss was
# reasonably foreseeable or Xilinx had been advised of the possibility of the
# same.
#
# CRITICAL APPLICATIONS
# Xilinx products are not designed or intended to be fail-safe, or for use in
# any application requiring failsafe performance, such as life-support or safety
# devices or systems, Class III medical devices, nuclear facilities, applications
# related to the deployment of airbags, or any other applications that could lead
# to death, personal injury, or severe property or environmental damage
# (individually and collectively, "Critical Applications"). Customer assumes the
# sole risk and liability of any use of Xilinx products in Critical Applications,
# subject only to applicable laws and regulations governing limitations on product
# liability.
#
# THIS COPYRIGHT NOTICE AND DISCLAIMER MUST BE RETAINED AS PART OF THIS FILE AT ALL TIMES.
# CS
create_ip -name axis_vio -vendor xilinx.com -library ip -version 1.0 -module_name vio_top
set_property -dict [list \
  CONFIG.C_NUM_PROBE_IN {6} \
  CONFIG.C_NUM_PROBE_OUT {6} \
  CONFIG.C_PROBE_IN2_WIDTH {64} \
  CONFIG.C_PROBE_IN3_WIDTH {64} \
  CONFIG.C_PROBE_IN4_WIDTH {16} \
  CONFIG.C_PROBE_OUT1_WIDTH {32} \
  CONFIG.C_PROBE_OUT2_WIDTH {16} \
  CONFIG.C_PROBE_OUT3_WIDTH {32} \
  CONFIG.C_PROBE_OUT4_WIDTH {16} \
  CONFIG.C_PROBE_OUT5_WIDTH {32} \
  CONFIG.C_PROBE_OUT5_INIT_VAL {0x0d15ea5e} \
] [get_ips vio_top]

create_ip -name axis_ila -vendor xilinx.com -library ip -version 1.2 -module_name ila_0
set_property -dict [list \
  CONFIG.C_EN_STRG_QUAL {1} \
  CONFIG.C_NUM_OF_PROBES {4} \
] [get_ips ila_0]

# Bypass buff
create_ip -name axis_data_fifo -vendor xilinx.com -library ip -version 2.0 -module_name axis_buff
set_property -dict [list \
  CONFIG.FIFO_DEPTH {32768} \
  CONFIG.FIFO_MEMORY_TYPE {auto} \
  CONFIG.TDATA_NUM_BYTES {4} \
] [get_ips axis_buff]

create_ip -name dsp_macro -vendor xilinx.com -library ip -version 1.0 -module_name dsp_macro_0
set_property -dict [list \
  CONFIG.a_binarywidth {0} \
  CONFIG.a_width {8} \
  CONFIG.areg_3 {true} \
  CONFIG.areg_4 {true} \
  CONFIG.b_binarywidth {0} \
  CONFIG.b_width {8} \
  CONFIG.breg_3 {true} \
  CONFIG.breg_4 {true} \
  CONFIG.c_binarywidth {0} \
  CONFIG.c_width {48} \
  CONFIG.concat_binarywidth {0} \
  CONFIG.concat_width {48} \
  CONFIG.creg_3 {false} \
  CONFIG.creg_4 {false} \
  CONFIG.creg_5 {false} \
  CONFIG.d_width {18} \
  CONFIG.has_ce {true} \
  CONFIG.instruction1 {A*B} \
  CONFIG.mreg_5 {true} \
  CONFIG.output_properties {Full_Precision} \
  CONFIG.p_binarywidth {0} \
  CONFIG.p_full_width {16} \
  CONFIG.p_width {16} \
  CONFIG.pcin_binarywidth {0} \
  CONFIG.pipeline_options {Automatic} \
  CONFIG.preg_6 {true} \
] [get_ips dsp_macro_0]

# AXIS reg
create_ip -name axis_register_slice -vendor xilinx.com -library ip -version 1.1 -module_name axis_reg_32
set_property CONFIG.TDATA_NUM_BYTES {4} [get_ips axis_reg_32]

# Instrumentation
create_ip -name dup_wrapper -vendor user.org -library hls -version 1.0 -module_name dup_wrapper_0
create_ip -name dup_wrapper_p0 -vendor user.org -library hls -version 1.0 -module_name dup_wrapper_p0_0

# Shuffles
create_ip -name shuffleA -vendor user.org -library hls -version 1.0 -module_name shuffleA_0
create_ip -name shuffleB -vendor user.org -library hls -version 1.0 -module_name shuffleB_0
create_ip -name shuffleC -vendor user.org -library hls -version 1.0 -module_name shuffleC_0

# Softmax
#create_ip -name softmaxquant -vendor user.org -library hls -version 1.0 -module_name softmaxquant_0
#create_ip -name layernorm -vendor user.org -library hls -version 1.0 -module_name layernorm_0